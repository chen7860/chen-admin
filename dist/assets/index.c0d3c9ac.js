import{P as v}from"./index.d6f853c0.js";import{M as w,a as f,w as y,o as g,k as T,B as E,n as _,i as L,F as M,aG as I,r as D,t as S,j as b,cJ as P}from"./index.40f28117.js";import"./index.4f5af4cb.js";import"./index.4a603b3b.js";import"./useBreakpoint.aac64a46.js";import"./responsiveObserve.c900bce4.js";import"./useSize.d39be33d.js";import"./useWindowSizeFn.8d01d8dc.js";import"./useContentViewHeight.a9642e78.js";import"./index.b7896ea2.js";import"./transButton.cca87ed8.js";import"./ArrowLeftOutlined.e04bc070.js";class F{constructor(){this.viewer=window.viewer,this.Cesium=Cesium,this.floatingPoint=null,this.curveGeojson=null,this.bgColor=null,this._ClosedCurve=null,this._ClosedCurveLast=null,this._positions=[],this._entities_point=[],this._entities_ClosedCurve=[],this._ClosedCurveData=null,this.ZERO_TOLERANCE=1e-4,this.FITTING_COUNT=100,this.t=.3,this.objId=Number(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}get ClosedCurve(){return this._ClosedCurveLast}getData(){return this._ClosedCurveData}computePosition(e){if(e.length<2)return;const i=[];for(let n=0;n<e.length;n++)i.push(this.cartesianToLatlng(e[n]));this._ClosedCurveData=Array.from(i),i.push(i[0],i[1]);let t=[];const s=[];for(let n=0;n<i.length-2;n++){const r=this.getBisectorNormals(this.t,i[n],i[n+1],i[n+2]);t=t.concat(r)}const a=t.length;t=[t[a-1]].concat(t.slice(0,a-1));for(let n=0;n<i.length-2;n++){const r=i[n],l=i[n+1];s.push(this.LatlngTocartesian(r));for(let c=0;c<=this.FITTING_COUNT;c++){const h=this.getCubicValue(c/this.FITTING_COUNT,r,t[n*2],t[n*2+1],l);s.push(this.LatlngTocartesian(h))}s.push(this.LatlngTocartesian(l))}return{PolygonHierarchy:new this.Cesium.PolygonHierarchy(s),pList:s}}addload(e){if(e.length<2)return;const i=Array.from(e);i.push(i[0],i[1]);let t=[];const s=[];for(let r=0;r<i.length-2;r++){const l=this.getBisectorNormals(this.t,i[r],i[r+1],i[r+2]);t=t.concat(l)}const a=t.length;t=[t[a-1]].concat(t.slice(0,a-1));for(let r=0;r<i.length-2;r++){const l=i[r],c=i[r+1];s.push(this.LatlngTocartesian(l));for(let h=0;h<=this.FITTING_COUNT;h++){const u=this.getCubicValue(h/this.FITTING_COUNT,l,t[r*2],t[r*2+1],c);s.push(this.LatlngTocartesian(u))}s.push(this.LatlngTocartesian(c))}const o=this.viewer.entities.add({Type:"DrawClosedCurve",Position:e,id:e.id||this.objId,polygon:{hierarchy:new this.Cesium.PolygonHierarchy(s),show:!0,fill:!0,clampToGround:!0,material:this.bgColor},polyline:{positions:s,show:!0,material:Cesium.Color.YELLOW,width:2,clampToGround:!0}}),n=[];for(let r=0;r<s.length;r++){const l=this.cartesianToLatlng(s[r]);n.push(l)}return this.curveGeojson=JSON.stringify({type:"Polygon",coordinates:[n]}),o}startCreate(e,i){this.curveGeojson=null,this.bgColor=Cesium.Color.fromCssColorString(e).withAlpha(.5),this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(t=>{const s=this.getCatesian3FromPX(t.position);this._positions.length==0&&(this.floatingPoint=this.createPoint(s)),this._positions.push(s),this.createPoint(s)},this.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(t=>{if(this._positions.length<2)return;const s=this.getCatesian3FromPX(t.endPosition);this._positions.length==2&&this._positions.push(s),this._positions.pop(),this._positions.push(s),this.Cesium.defined(this._ClosedCurve)||(this._ClosedCurve=this.createClosedCurve())},this.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(t=>{if(!this._ClosedCurve)return;const s=this.getCatesian3FromPX(t.position);this._positions.pop(),this._positions.push(s),this._ClosedCurveData=this._positions.concat(),this.viewer.entities.remove(this._ClosedCurve),this._ClosedCurve=null,this._positions=[],this.floatingPoint.position.setValue(s);const a=[];for(let n=0;n<this._ClosedCurveData.length;n++){const r=this.cartesianToLatlng(this._ClosedCurveData[n]);a.push(r)}this._ClosedCurveData=a;const o=this.addload(a);this._entities_ClosedCurve.push(o),this._ClosedCurveLast=o,this.clearPoint(),this.destroy(),i(this.curveGeojson)},this.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createClosedCurve(){this.pLists="";const e=this.viewer.entities.add({polygon:{hierarchy:new this.Cesium.CallbackProperty(()=>{if(this._positions.length<2)return;const i=[];for(let o=0;o<this._positions.length;o++)i.push(this.cartesianToLatlng(this._positions[o]));i.push(i[0],i[1]);let t=[];const s=[];for(let o=0;o<i.length-2;o++){const n=this.getBisectorNormals(this.t,i[o],i[o+1],i[o+2]);t=t.concat(n)}const a=t.length;t=[t[a-1]].concat(t.slice(0,a-1));for(let o=0;o<i.length-2;o++){const n=i[o],r=i[o+1];s.push(this.LatlngTocartesian(n));for(let l=0;l<=this.FITTING_COUNT;l++){const c=this.getCubicValue(l/this.FITTING_COUNT,n,t[o*2],t[o*2+1],r);s.push(this.LatlngTocartesian(c))}s.push(this.LatlngTocartesian(r))}return this.pLists=s,new this.Cesium.PolygonHierarchy(s)},!1),show:!0,fill:!0,clampToGround:!0,material:this.bgColor},polyline:{positions:new this.Cesium.CallbackProperty(()=>this.pLists,!1),show:!0,material:Cesium.Color.YELLOW,width:2,clampToGround:!0}});return this._entities_ClosedCurve.push(e),e}createPoint(e){const i=this.viewer.entities.add({position:e,point:{pixelSize:5,color:this.Cesium.Color.YELLOW}});return this._entities_point.push(i),i}cartesianToLatlng(e){const i=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),t=this.Cesium.Math.toDegrees(i.latitude);return[this.Cesium.Math.toDegrees(i.longitude),t]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}lonLatToMercator(e){const i=e[0],t=e[1],s=i*2003750834e-2/180;let a=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return a=a*2003750834e-2/180,[s,a]}WebMercator2lonLat(e){const i=e[0]/2003750834e-2*180,t=e[1]/2003750834e-2*180,s=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2);return[i,s]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this._ClosedCurveLast,this._ClosedCurveData);for(let e=0;e<this._entities_point.length;e++)this.viewer.entities.remove(this._entities_point[e]);this._entities_point=[]}clear(){for(let e=0;e<this._entities_point.length;e++)this.viewer.entities.remove(this._entities_point[e]);for(let e=0;e<this._entities_ClosedCurve.length;e++)this.viewer.entities.remove(this._entities_ClosedCurve[e]);this.floatingPoint=null,this._ClosedCurve=null,this._ClosedCurveLast=null,this._positions=[],this._entities_point=[],this._entities_ClosedCurve=[],this._ClosedCurveData=null}getCatesian3FromPX(e){const i=this.viewer.camera.getPickRay(e);return i?this.viewer.scene.globe.pick(i,this.viewer.scene):null}getBisectorNormals(e,i,t,s){const a=this.getNormal(i,t,s);let[o,n,r,l,c]=[[0,0],[0,0],0,0,0];const h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=a[0]/h,C=a[1]/h,d=this.MathDistance(i,t),m=this.MathDistance(t,s);return h>this.ZERO_TOLERANCE?this.isClockWise(i,t,s)?(r=e*d,l=t[0]-r*C,c=t[1]+r*u,o=[l,c],r=e*m,l=t[0]+r*C,c=t[1]-r*u,n=[l,c]):(r=e*d,l=t[0]+r*C,c=t[1]-r*u,o=[l,c],r=e*m,l=t[0]-r*C,c=t[1]+r*u,n=[l,c]):(l=t[0]+e*(i[0]-t[0]),c=t[1]+e*(i[1]-t[1]),o=[l,c],l=t[0]+e*(s[0]-t[0]),c=t[1]+e*(s[1]-t[1]),n=[l,c]),[o,n]}getNormal(e,i,t){let s=e[0]-i[0],a=e[1]-i[1];const o=Math.sqrt(s*s+a*a);s/=o,a/=o;let n=t[0]-i[0],r=t[1]-i[1];const l=Math.sqrt(n*n+r*r);n/=l,r/=l;const c=s+n,h=a+r;return[c,h]}MathDistance(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}isClockWise(e,i,t){return(t[1]-e[1])*(i[0]-e[0])>(i[1]-e[1])*(t[0]-e[0])}getCubicValue(e,i,t,s,a){e=Math.max(Math.min(e,1),0);const[o,n]=[1-e,e*e],r=n*e,l=o*o,c=l*o,h=c*i[0]+3*l*e*t[0]+3*o*n*s[0]+r*a[0],u=c*i[1]+3*l*e*t[1]+3*o*n*s[1]+r*a[1];return[h,u]}}class k{constructor(){this.circle_center_entity=null,this.temporary_circle_entity=null,this.circle_entity=null,this.circle_end_point=null,this.circle_center_point=null,this.viewer=window.viewer}startCreate(e){this.bgColor=Cesium.Color.fromCssColorString(e).withAlpha(.5),this.clear(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(i=>{const t=this.viewer.camera.getPickRay(i.position);if(!t)return;const s=this.viewer.scene.globe.pick(t,this.viewer.scene);if(!s)return;const o=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(s),n=Cesium.Math.toDegrees(o.longitude),r=Cesium.Math.toDegrees(o.latitude);this.circle_center_entity&&(this.circle_end_point={lon:n,lat:r,height:0},this.draw_circle(),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.viewer.entities.remove(this.circle_center_entity),this.temporary_circle_entity&&this.viewer.entities.remove(this.temporary_circle_entity))},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction(i=>{const t=this.viewer.camera.getPickRay(i.position);if(!t)return;const s=this.viewer.scene.globe.pick(t,this.viewer.scene);if(!s)return;const o=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(s),n=Cesium.Math.toDegrees(o.longitude),r=Cesium.Math.toDegrees(o.latitude);this.circle_center_entity||(this.circle_center_point={lon:n,lat:r,height:0},this.create_circle_center_point([n,r]),this.draw_dynamic_circle(this.circle_center_point),this.handler.setInputAction(l=>{const c=this.viewer.camera.getPickRay(l.endPosition);if(!c)return;const h=this.viewer.scene.globe.pick(c,this.viewer.scene);if(!h)return;const C=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(h),d=Cesium.Math.toDegrees(C.longitude),m=Cesium.Math.toDegrees(C.latitude);this.temporary_circle_entity&&(this.circle_end_point={lon:d,lat:m,height:0})},Cesium.ScreenSpaceEventType.MOUSE_MOVE))},Cesium.ScreenSpaceEventType.LEFT_CLICK)}create_circle_center_point(e){this.circle_center_entity=this.viewer.entities.add({id:"circle_center_"+Date.now(),position:Cesium.Cartesian3.fromDegrees(e[0],e[1],100),point:{pixelSize:5,color:Cesium.Color.WHITE,outlineColor:Cesium.Color.fromCssColorString("#fff"),outlineWidth:2,show:!0}})}draw_dynamic_circle(e){this.temporary_circle_entity=this.viewer.entities.add({id:"draw_dynamic_circle_"+Date.now(),position:Cesium.Cartesian3.fromDegrees(e.lon,e.lat),ellipse:{semiMinorAxis:new Cesium.CallbackProperty(()=>{if(this.circle_end_point)return this.two_points_distance(e,this.circle_end_point)},!1),semiMajorAxis:new Cesium.CallbackProperty(()=>{if(this.circle_end_point)return this.two_points_distance(e,this.circle_end_point)},!1),material:this.bgColor,outline:!1,outlineColor:Cesium.Color.YELLOW,outlineWidth:20},polyline:{positions:new Cesium.CallbackProperty(()=>{if(!this.circle_end_point)return[];const i=this.two_points_distance(e,this.circle_end_point),t=[],s=3600;for(let a=0;a<=s;a++){const o=a/s*Cesium.Math.TWO_PI,n=e.lon+i*Math.cos(o)/(111320*Math.cos(e.lat*Math.PI/180)),r=e.lat+i*Math.sin(o)/111320;t.push(Cesium.Cartesian3.fromDegrees(n,r))}return t},!1),width:2,material:Cesium.Color.YELLOW,clampToGround:!0}})}draw_circle(){if(!this.circle_end_point)return[];const e=this.two_points_distance(this.circle_center_point,this.circle_end_point),i=[],t=3600;for(let s=0;s<=t;s++){const a=s/t*Cesium.Math.TWO_PI,o=this.circle_center_point.lon+e*Math.cos(a)/(111320*Math.cos(this.circle_center_point.lat*Math.PI/180)),n=this.circle_center_point.lat+e*Math.sin(a)/111320;i.push(Cesium.Cartesian3.fromDegrees(o,n))}this.circle_entity=this.viewer.entities.add({id:"draw_circle_"+Date.now(),position:Cesium.Cartesian3.fromDegrees(this.circle_center_point.lon,this.circle_center_point.lat),ellipse:{semiMinorAxis:this.two_points_distance(this.circle_center_point,this.circle_end_point),semiMajorAxis:this.two_points_distance(this.circle_center_point,this.circle_end_point),material:this.bgColor,outline:!0,outlineColor:Cesium.Color.WHITE,outlineWidth:4},polyline:{positions:i,width:2,material:Cesium.Color.YELLOW,clampToGround:!0}})}two_points_distance(e,i){const t=Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.height),s=Cesium.Cartesian3.fromDegrees(i.lon,i.lat,i.height);return Cesium.Cartesian3.distance(t,s)}clear(){this.circle_entity!==null&&(this.circle_center_entity&&this.viewer.entities.remove(this.circle_center_entity),this.temporary_circle_entity&&this.viewer.entities.remove(this.temporary_circle_entity),this.viewer.entities.remove(this.circle_entity),this.circle_center_entity=null,this.temporary_circle_entity=null,this.circle_entity=null,this.circle_end_point=null,this.circle_center_point=null),this.handler&&(this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK))}}class A{constructor(){this.viewer=window.viewer,this.config={borderColor:Cesium.Color.YELLOW,borderWidth:2,material:Cesium.Color.fromCssColorString("#7F4538").withAlpha(.5)},this.infoDetail={point:[],line:[],rectangle:[],circle:[],planeSelf:[]},this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)}drawRectangle(){this.handler.destroy();let e=[],i=new Date().getTime();this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(t=>{const s=this.viewer.camera.pickEllipsoid(t.position,this.viewer.scene.globe.ellipsoid),a=Cesium.Cartographic.fromCartesian(s,this.viewer.scene.globe.ellipsoid,new Cesium.Cartographic),o=Cesium.Math.toDegrees(a.longitude),n=Cesium.Math.toDegrees(a.latitude);e=[o,n],i=new Date().getTime(),e&&this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.entity=this.viewer.entities.add({name:"rectangle",id:i,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return{positions:Cesium.Cartesian3.fromDegreesArray(e)}},!1),height:0,material:this.config.material,fill:!0,show:!0},polyline:{positions:new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.fromDegreesArray(e)},!1),material:this.config.borderColor,width:this.config.borderWidth,zIndex:1}}),this.handler.setInputAction(r=>{const l=this.viewer.camera.pickEllipsoid(r.endPosition,this.viewer.scene.globe.ellipsoid),c=Cesium.Cartographic.fromCartesian(l,this.viewer.scene.globe.ellipsoid,new Cesium.Cartographic),h=Cesium.Math.toDegrees(c.longitude),u=Cesium.Math.toDegrees(c.latitude);e=[o,n,o,u,h,u,h,n,o,n]},Cesium.ScreenSpaceEventType.MOUSE_MOVE)},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(()=>{this.handler.destroy(),this.infoDetail.rectangle.push({id:i,position:e})},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}clear(){this.entity&&this.viewer.entities.remove(this.entity)}backInfoDetail(){return this.infoDetail}}class O{constructor(){this.curve=new F,this.circle=new k,this.rectangle=new A}drawCurve(e,i){this.curve.startCreate(e,i)}clearCurve(){this.curve.clear()}drawCircle(e){this.circle.startCreate(e)}clearCircle(){this.circle.clear()}drawRectangle(){this.rectangle.drawRectangle()}clearRectangle(){this.rectangle.clear()}clearAll(){this.clearCurve(),this.clearCircle(),this.clearRectangle()}}const N={class:"lg:flex"},x={class:"tool"},G={class:"list"},R=["onClick"],W=f({__name:"index",setup(p){const e=["\u77E9\u5F62","\u5706\u5F62","\u66F2\u7EBF"],i=y("");let t;function s(o){switch(t||(t=new O),t.clearAll(),i.value=o,P.info("\u5355\u51FB\u5C4F\u5E55\u5F00\u59CB\u7ED8\u5236\uFF0C\u53F3\u952E\u7ED3\u675F\u7ED8\u5236"),o){case"\u77E9\u5F62":t.drawRectangle();break;case"\u5706\u5F62":t.drawCircle("#7F4538");break;case"\u66F2\u7EBF":t.drawCurve("#7F4538",n=>{console.log(n)});break}}function a(){switch(i.value){case"\u77E9\u5F62":break;case"\u5706\u5F62":t.clearCircle(),t.drawCircle("#7F4538");break;case"\u66F2\u7EBF":t.clearCurve(),t.drawCurve("#7F4538",o=>{console.log(o)});break}}return(o,n)=>(g(),T(b(v),null,{default:E(()=>[_("div",N,[_("div",x,[_("div",G,[(g(),L(M,null,I(e,r=>_("div",{class:D({item:!0,active:i.value===r}),key:r,onClick:l=>s(r)},S(r),11,R)),64))]),_("div",{class:"clear",onClick:a},"\u6E05\u9664")])])]),_:1}))}});var $=w(W,[["__scopeId","data-v-19f6f897"]]);export{$ as default};
